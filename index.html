<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Explore Watershed Health</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=7, IE=8, IE=9, IE=10">
    <meta name="description" content="">
    <meta name="author" content="Zach Tagar, MN DNR">

    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon"/>
    <link rel="icon" href="./favicon.ico" type="image/x-icon"/>
    <link rel="stylesheet" href="./css/ui.1.10.3.themes.smoothness.jquery-ui.css">
    <link href="./css/bootstrap-responsive.css" rel="stylesheet">
    <link href="./css/bootstrap.css" rel="stylesheet">    
    <link rel="stylesheet" href="./css/esri.css">
    <link rel="stylesheet" href="./css/bootstrap-colorpicker.css">
    <link rel="stylesheet" href="./css/WHAF.css">

</head>

<body style = "opacity:0.3">

    <div id="tutPlace"></div>
    <div id="disclaimerPlace"></div>
    <div id="BMWarningPlace"></div>
    <div id="objectivesPlace"></div>
    <div id="appInfoPlace"></div>
    <!-- <div id="snapShotsPlace"></div> -->
    <div id="addLayerPlace"></div> 
    <div id="waterUsePlace"></div>
    <a id="snapCtrlL" class="carousel-control snapCtrl left" href="#" onclick="nextSnap('-')">&lsaquo;</a>
    <a id="snapCtrlR" class="carousel-control snapCtrl right" href="#" onclick="nextSnap('+')">&rsaquo;</a>
    <div id="snapViewCtrol">
        <a class="carousel-control snapViewCtrl" id="snapMin" href="#" onclick="$('#snapShotsArea, #snapViewCtrol, .snapCtrl').fadeOut(); snapPlus()"><i>x</i></a>
        <a class="carousel-control snapViewCtrl" id="slideShowPrep" href="#" onclick="slideShowPrep()"><i> &nbsp; &nbsp;Slide Show &nbsp;&nbsp;</i></a>
    </div>
    <a class="carousel-control right" id="snapMax" href="#" data-placement="left" data-toggle="tooltip" data-original-title="Show Map Gallery" onclick="snapBringUp(); $(this).hide()"><i>+</i></a>

    <div id="pieChartModal" class="well well-info" style="position:absolute" data-backdrop="false" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="$('#pieChartModal').hide()" style="color:white;">×</button>
        </div>
        <div id="piePlaceTitle" style="margin:auto;color:white;margin:15px;"></div>
        <div id="piePlace" style="cursor:pointer"></div>
    </div>

    <div id="layerSelectionModal" class="well span10" style="position:absolute; padding:8px; border: 1px solid #717171"> </div>

    <div id="layersModal" class="well" style="position:absolute; padding:8px; border: 1px solid #717171; cursor:move" data-backdrop="false" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-header">
            <button type="button" style="opacity:1; margin-top:-12px" class="close closeX" data-dismiss="modal" aria-hidden="true" onclick="$('#layersModal').hide();setModalElement($('#myModal'))">×</button>
            <h4 id="layersModalLabel">Select additional layers</h4>

            <div class="tabbable" id="addedLyrsTab">
                <ul id="auxAddTabs" class="nav nav-tabs">
                    <li class="active"><a href="#addLayerBox3" data-toggle="tab" onclick="">Available layers</a></li>
                    <li id="indRelatedTab" class='disabled'><a href="#addLayerBox5" data-toggle="tab" onclick="lyrListToggler('el')">Index related layers</a></li>
                    <li><a href="#addLayerBox4" data-toggle="tab">Layers from web</a></li>
                </ul>
                <div class="tab-content">
                    <div id="addLayerBox3" class="tab-pane active">
                        <div id="adHocLayerLister" class="btn-group">
                            <input id="adHocLayerList" class="dropdown-toggle btn-block" autocomplete="off" placeholder="Search available layers" data-toggle="dropdown" type="text">
                            <ul id="adHocLayerListUl" class="dropdown-menu span4" style="display: block;position: relative;margin-left: 0px;" role="menu" aria-labelledby="dropdownMenu"></ul>
                        </div>
                        <div id="GDRSnote2">* Layer available only inside the DNR network </div>
                    </div>
                    <div id="addLayerBox4" class="tab-pane">
                        <h5 id="layersModalLabel">Add features from the web: &#160;<a title="Online map services can be added to this map. Click here for detailed information." a href="http://www.dnr.state.mn.us/whaf/explore/services.html" target='_blank' class="icon-question-sign"></a></h5> 
                        <div id="adHocLayerLister2" class="btn-group btn-block">
                            <input id="AddingRestPoint" class="dropdown-toggle btn-block" placeholder="Enter REST url here" data-toggle="dropdown" type="text" autocomplete="off">
                            <div class="row-fluid btn-block">
                                <div id="layerNameArea" class="span10">
                                    <input class="span10" id="addedLayerName" type="text" autocomplete="off" placeholder="Layer name">
                                </div>                        
                                <div class="span2">
                                    <input class="btn btn-block btn-info" type="button" onclick="preProcessRestUrl()" value="Add">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="addLayerBox5" class="tab-pane">

                      <div id="noIndexNote" class="alert">
                          To view a list of related layers, display a health score index.
                        </div>                
                        <p id="indexTitleForLyrs"></p>
                        <div id="adHocLayerLister2" class="btn-group">
                            <ul id="adHocLayerListUl2" class="dropdown-menu span4" style="display: none;position: relative;margin-left: 0px;" role="menu" aria-labelledby="dropdownMenu">
                                

                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <div id="HeadBar" class="navbar navbar-inverse" role="navigation">
      <div id="projectShowTitleWrapper" class="navbar-inner projectTitle" style="display:none">
          <input class="projectTitle" id="projectShowTitle" autocomplete="off" placeholder="My WHAF presentation" type="text">

                  <a class="carousel-control pull-right" id="stripView" href="#" onclick="removeSlideShow()"><i> &nbsp; &nbsp;Close &nbsp;&nbsp;</i></a>

      </div>


      <!-- <div id="WHAF_headerNav" class="navbar-inner"> -->
        <div id="WHAF_headerNav" class="container-fluid">
            <div class="navbar-header"> 
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>

                <a class="brand" style="padding:5px;margin-left:-17px;margin-right:5px;"><img SRC="./img/dnrlogo_normal.png" alt="MN DNR" style="height:30px"></a>
                <a class="brand">WATERSHED HEALTH ASSESSMENT FRAMEWORK</a>

                <div id="headControls" class="nav-collapse collapse">

                    <ul class="nav navbar-nav">
                        <li class="active"><a href="http://www.dnr.state.mn.us/whaf/index.html" target='_blank'>Home</a>
                        </li>
                        <li><a href="#about" onclick="$('#info1').fadeToggle();">What's a watershed?</a>
                        </li>
                        <li><a href="http://gisdata.mn.gov/dataset/env-watershed-health-assessment" target="_blank" onclick="">Data download</a>
                        </li>
                        <li><a href="#" style="display:none" onclick="startDss()">DSS</a>
                        </li>

                        <li id="fat-menu2" class="dropdown"><a href="#" role="button" class="dropdown-toggle" data-toggle="dropdown" title="" id="howToDromDown">Help: <b class="caret"></b></a>

                            <ul id="dropDownHowToList" class="dropdown-menu" style="" role="menu">

                                <li class="">
                                    <a tabindex="-1" href="#" class="titlStay" onclick="$('#guidesSubMenu, #tutVidsSubMenu, #tutHandoutSubMenu, #indexInfoSubMenu').hide();$('#howToSubMenu').toggle()"> <strong> Find a Tool </strong></a>
                                    <ul id="howToSubMenu" class="dropdown-menu subMenu" >
                                        
                                        <li class="howTo" id="HealthScoresButton" role="presentation"><a role="menuitem" tabindex="-1" onmouseover="$('#menu_scores').addClass('highlightBorder')" onmouseout="$('#menu_scores').removeClass('highlightBorder')" href="#tab" data-toggle="tab3"
                                            onclick="$('#menu_scores').click();"> View health scores </a>
                                        </li>

                                        <li class="howTo" id="add_features" role="presentation"><a role="menuitem" tabindex="-1" onmouseover="$('#menu_features').addClass('highlightBorder')" onmouseout="$('#menu_features').removeClass('highlightBorder')"
                                            onclick="$('#menu_features').click()" href="#"> Add features to web map </a>
                                        </li>

                                        <li class="howTo" id="add_features" role="presentation"><a role="menuitem" tabindex="-1" onmouseover="$('#menu_base').addClass('highlightBorder')" onmouseout="$('#menu_base').removeClass('highlightBorder')" onclick="$('#menu_base').click()" href="#"> Change base map</a>
                                        </li>

                                        <li class="howTo" id="add_features" role="presentation"><a role="menuitem" tabindex="-1" onmouseover="$('#menu_share').addClass('highlightBorder')" onmouseout="$('#menu_share').removeClass('highlightBorder')" onclick="$('#menu_share').click()" href="#"> Share this current view</a>
                                        </li>

                                        <li class="howTo" id="add_features" role="presentation"><a role="menuitem" tabindex="-1" onmouseover="$('#menu_bkmark').addClass('highlightBorder')" onmouseout="$('#menu_bkmark').removeClass('highlightBorder')" onclick="$('#menu_bkmark').click()" href="#"> Bookmark map view</a>
                                        </li>

                                        <li class="howTo" id="add_features" role="presentation"><a role="menuitem" tabindex="-1" onmouseover="$('#menu_refresh').addClass('highlightBorder')" onmouseout="$('#menu_refresh').removeClass('highlightBorder')" onclick="" href="#"> Refresh the map</a>
                                        </li>

                                        <li class="howTo" id="add_features" role="presentation"><a role="menuitem" tabindex="-1" onmouseover="$('#DssStarImage').addClass('highlightBorder')" onmouseout="$('#DssStarImage').removeClass('highlightBorder')" onclick="$('#DssStarImage').click()" href="#"> Set or change location on the map</a>
                                        </li>

                                        <li class="howTo" id="add_features" role="presentation"><a role="menuitem" tabindex="-1" onmouseover="$('#menu_addSnap').addClass('highlightBorder')" onmouseout="$('#menu_addSnap').removeClass('highlightBorder')" onclick="" href="#"> Add a map to the map gallery</a>
                                        </li>

                                        <li class="howTo" id="add_features" role="presentation"><a role="menuitem" tabindex="-1" onmouseover="$('#back').addClass('highlightBorder')" onmouseout="$('#back').removeClass('highlightBorder')" onclick="" href="#"> Return to previous or next location</a>
                                        </li>
                                        
                                    </ul>
                                </li>

                                <li role="presentation" class="divider"></li>

                                <li class="">

                                    <a tabindex="-1" href="#" class="titlStay" onclick="$('#howToSubMenu, #tutVidsSubMenu, #tutHandoutSubMenu, #indexInfoSubMenu').hide();$('#guidesSubMenu').toggle()"> <strong> Use Guides </strong></a>

                                        <ul id="guidesSubMenu" class="dropdown-menu subMenu" >
                                            <li class="howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" onclick="$('#tutorial').modal('show');" href="#"> Application Overview</a>
                                            </li>
                                            <li class="howTo" id="add_features" role="presentation"><a role="menuitem" tabindex="-1" onclick="startGuide('pieChartGuide'); $('#pieChartModal').fadeIn()" href="#"> Compare Watershed Scores</a>
                                            </li>
                                            <li class="" role="presentation"><a role="menuitem" tabindex="-1"  href="#" onclick="startGuide('scalesGuide');">Explore Scales</a>
                                            </li>
                                            <li class="" role="presentation"><a role="menuitem" tabindex="-1"  href="#" onclick="startGuide('featuresGuide');">Add Features to Map</a>
                                            </li>
                                        </ul>
                                </li>

                                <li role="presentation" class="divider"></li>

                                <li id = "TutVidMenu" class="howTo">
                                    <a href="#" class="titlStay" onclick="$('#guidesSubMenu, #howToSubMenu, #tutHandoutSubMenu, #indexInfoSubMenu').hide();$('#tutVidsSubMenu').toggle()"><strong> Tutorial Videos</strong></a>
                                

                                        <ul id="tutVidsSubMenu" class="dropdown-menu subMenu" >
                                           
                                            <li class="howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" href="http://www.youtube.com/watch_popup?v=9FJ7GNCF7pE" target="_blank"> Navigating the Map</a>
                                            </li>

                                            <li class="howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" href="http://www.youtube.com/watch_popup?v=dlfgkLoE1TY" target="_blank"> Location and Scale</a>
                                            </li>
                                            <li class="howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" href="http://www.youtube.com/watch_popup?v=WGbeA5nwMqo" target="_blank"> Accessing Health Scores</a>
                                            </li>
                                            <li class="howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" href="http://www.youtube.com/watch_popup?v=v0K7b9HtpR4" target="_blank"> Additional Map Data</a>
                                            </li>
                                            <li class="howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" href="http://www.youtube.com/watch_popup?v=1wJySdgkgp4" target="_blank"> Saving and Sharing Maps</a>
                                            </li>
                                            <li class="howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" href="http://www.youtube.com/watch_popup?v=M-poRwXfOkk" target="_blank"> Advanced Bookmarks and Map Gallery Tool</a>
                                            </li>                                      
                                        </ul>
                                </li>

                                <li role="presentation" class="divider"></li>

                                <li id = "TutHandoutMenu" class="howTo">
                                    <a href="#" class="titlStay" onclick="$('#guidesSubMenu, #howToSubMenu, #tutVidsSubMenu, #indexInfoSubMenu').hide();$('#tutHandoutSubMenu').toggle()"><strong> Handouts</strong></a>

                                        <ul id="tutHandoutSubMenu" class="dropdown-menu subMenu" >

                                            <li class "howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" href="http://files.dnr.state.mn.us/natural_resources/water/watersheds/tool/watersheds/explorehealth.pdf" target="_blank"> The Watershed Exploration Process <img src="http://images.dnr.state.mn.us/pdf_logo.gif" width="22" height="9" border="0" alt="PDF"> </a>
                                            </li>

                                            <li class "howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" href="http://files.dnr.state.mn.us/natural_resources/water/watersheds/tool/watersheds/bookmarks.pdf" target="_blank"> Create and Share Bookmarks <img src="http://images.dnr.state.mn.us/pdf_logo.gif" width="22" height="9" border="0" alt="PDF"> </a>
                                            </li>

                                            <li class "howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" href="http://files.dnr.state.mn.us/natural_resources/water/watersheds/tool/watersheds/mapgallery.pdf" target="_blank"> Create a Map Gallery Slideshow <img src="http://images.dnr.state.mn.us/pdf_logo.gif" width="22" height="9" border="0" alt="PDF"> </a>
                                            </li>
                                        </ul>
                                </li>

                                <li role="presentation" class="divider"></li>

                                <li id = "IndexInfoMenu" class="howTo">
                                    <a href="#" class="titlStay" onclick="$('#guidesSubMenu, #howToSubMenu, #tutVidsSubMenu, #tutHandoutSubMenu').hide();$('#indexInfoSubMenu').toggle()"><strong> Health Index Information</strong></a>

                                        <ul id="indexInfoSubMenu" class="dropdown-menu subMenu" >

                                            <li class "howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" href="http://www.dnr.state.mn.us/whaf/about/scores/index.html" target="_blank" title="Click to go to the Watershed Health Assessment Framework web page with detailed descriptions of health indices"> Index Scores - Detailed Descriptions</a>
                                            </li>

                                            <li class "howTo" id="" role="presentation"><a role="menuitem" tabindex="-1" href="http://files.dnr.state.mn.us/natural_resources/water/watersheds/tool/watersheds/index_score_summary_table.pdf" target="_blank" title="PDF with all index score short descriptions, explenation of values, and list of data sources."> Index Scores - Summary Table <img src="http://images.dnr.state.mn.us/pdf_logo.gif" width="22" height="9" border="0" alt="PDF"></a>
                                            </li>
                                        </ul>
                                </li>
                                
                                <li role="presentation" class="divider"></li>

                                <li class="howTo" role="presentation"><a role="menuitem" tabindex="-1" onclick="$('#disclaimer').modal('show')" href="#"> Disclaimer</a>
                                </li>
                            </ul>
                        </li>



                    </ul>

                    <div id = "searchPlace" class="pull-right" >
                        <div id="search" class="WhafTool" style="max-height:28px"></div>
                    </div>

                </div>

            </div>

        </div>
    </div>


    <div id="WHAF_app" class="container-fluid">
        <div class="navbar" id="DSS_title" style="display:none">

            <div class="navbar-inner whafNavbar" id="DSS_title-inner">

                <div class="text-left whafBrand" id="DSS_control_back" style="" onclick="DSS_backer()"> <span id="DSS_backButton" class="btn btn-info noMarg" style="display:none" >Back</span> </div>
                <div class="whafBrand" id="DSS_StepCurrent" >    
                    <div class="text-center whafBrand" id="DSS_stepTitle"></div>
                    <div id="inCurrentStep" class="pull-right">

                        <div class="" id="scalePlace"></div>                        
                        
                    </div>
                </div>
                <div class="text-right whafBrand" id="DSS_control_next" style="" onclick="DSS_nexter()"> <span class="btn btn-info noMarg">Next</span></div>
            </div>
        </div>

        <div class="navbar" id="guide_title" style="display:none; cursor:move">
            <button onclick="$('#guide_title').fadeToggle(); guideReset();" style="opacity:1;" class="close" type="button" data-original-title="" title="">×</button>
            <div class="navbar-inner whafNavbar" id="guide_title-inner">

                <div class="" id="guide_stepTitle"><h4></h4></div>
                <div id="guideMidSection" class="row" style="margin-left:0px">
                    <div class="span2 whafBrand2" id="guide_control_back" style="" onclick="guides.guide_backer()"> <span id="guide_backButton" class="btn btn-info noMarg" style="" > <i class="icon-chevron-left"></i></span> </div>

                    <div class="span6 whafBrand2" id="guide_StepCurrent" >    
                        
                        <div id="inGuideCurrentStep" class="pull-right"> </div>
                    </div>
                    <div class="span2 whafBrand2" id="guide_control_next" onclick="guides.guide_nexter()"> <span class="btn btn-info noMarg"><i class="icon-chevron-right"></i></span></div>
                </div>
            </div>
        </div>

        <div class="navbar" id="cdlChartPlace" style="display:none;">
           
            <button id="chartCloserL" type="button" class="close" style="opacity:0.9" onclick="$('#cdlChartPlace').fadeToggle();">&times;</button>
            <div class="chartTitle1"><h4 id="mainChartsTitle" class="chartTitle1">  </h4>   </div>
            <div id="" class="chartTitle2"><p id="landUseChartsTitle"></p></div>
            <div id="" class="chartTitle2"><p id="landUseChartsArea"></p></div>
            
            <div class="" id="NLCD_chart_div-inner">
                <div class="chartTitle1" id="nlcd_Title"><h6 class="chartTitle1">Land Cover Type (NLCD)</h6></div>
                <div id="NLCD_chart_div"></div>
            </div>
            <div class="" id="CDL_chart_div-inner">
                <div class="chartTitle1" id="cdl_Title"><h6 class="chartTitle1">Crop Type (CDL)</h6></div>
                <div id="CDL_chart_div"></div>
            </div>
        </div>

        <div id="molecule">
            
        </div>


        <div class="row-fluid">

            <div id="mapWrap" class="span12 modalDisappear">


                <div id="map">  
                    <div id="servWarningPlace">
                        <div id = "serverWarningPlace" class="alert alert-error" style="">
                            <div id="servWarnText" style=""> Sorry, some functions are temporarily unavailable. Please try again later.</div>    
                        </div>
                    </div>

                    <div id="TabOfcontentPlace">
                        <div id="indexTitlePlace">
                            
                            <div id = "indexTitle_slider" class="" style="overflow:hidden;"> 
                                <div id="indexTitle_place" class = "well sideItem menuWrapperW" style="display:inline-block; overflow:hidden;">
                                   <div id="drop2" class="compHeadFont"></div>
                                   <div id="scoreTimeStamp"></div>
                                       <div style="display:inline-block" id="opacTex" style="float:left">Transparency:</div> 
                                       <div style="display:inline-block" id = "aSlider" class="buttonaSlider " style="float:left"></div>  


                                       <div style="display:inline-block"><button id="indRemoveBut" class="btn btn-mini" data-placement="left" data-toggle="tooltip" data-original-title="Remove Index Scores" style="margin-left:13px;" onclick="removeFirstLayer(); hideLegend(); $('#indexTitle_slider').hide();" ><i class="icon-remove-circle"></i></button></div>

                                    <!-- </div>   -->
                                   <!-- </div> -->
                                </div>
                            </div>

                        </div>

                        <div id="DSS_indexTitlePlace" style="">
                            
                            <div id = "DSS_indexTitle_slider" class="" style="overflow:hidden;width:500px"> 
                                <div id="DSS_indexTitle_place" class = "well sideItem menuWrapperW" style="display:inline-block; overflow:hidden;">
                                   <div id="DSS_drop2" class="compHeadFont"></div>
                                   <div id="DSS_opacTex" style="float:left">Transparency:</div> 
                                   <div id = "DSS_aSlider" class="buttonaSlider " style="float:left"></div>
                                </div>
                            </div>

                        </div>

                        <div id="featuresPlace">
                        
                           
                            <div class="tab-pane well sideItem menuWrapperW" id="addFeatures" >

                                <button type="button" class="close" style="opacity:1;margin-top:-18px; margin-right:-18px;" onclick="$('#featuresPlace').fadeToggle();">×</button>

                                <div id="featureTabs">
                                    <ul>
                                        <li id="hohoLi"><a onclick="fixTabsCss('hohoLi')" href="#featureTab1">Map layers</a></li>
                                        <li id="momoLi"><a onclick="fixTabsCss('momoLi')" href="#featureTab2">Legend</a></li>                           
                                    </ul>

                                    <div id="featureTab1">
                                        <div id="plusLayersPlace">
                                            <button id="plusLayers" class="btn btn-small btn-block btn-info" type="button" onclick="$('#layersModal').fadeIn();">Get more layers</button>
                                        </div>


                                        <div id = "featurePlace" style="min-height: 10%;" class="tab-content">
                                            <div class="tabbable" id="tabMoreAuxFeatures">
                                                <div style="overflow:auto;" id='addedLayerBox'>
                                                    <div class="ui-state-default state-default1" id = "hillshadeButton"><div class="row-fluid"><label class="checkbox auxFeatCheck span5"><input type="checkbox" id = "hillShadeCheck" onclick="console.log(checked);checkLayerbyID(checked, $(this).parent().parent().parent().attr('id'));respondToAddFeatureUrl(checked, hillshadeService, hillshadeLayer, 'Hillshade','*', $(this).parent().parent())" autocomplete="off" title="" value="NaN">Hillshade topography</label><div class="offset1 span5"><div id = "hillSlider" class="buttonSlider " ></div></div><div class="span1 pull-right"></div></div>
                                                    </div>

                                                    <div class="sortable" id="selSortable">

                                                    <div class="ui-state-default state-default1" id = "customImpBut">
                                                        <div class="row-fluid">
                                                            <label class="checkbox auxFeatCheck span9"><input type="checkbox" id = "impLayerButt" onclick="impLyrsToggler($(this)) " autocomplete="off" title="" value="NaN">Custom Impaired Waters Layers</label>
                                                            <div class="span2"><button class="btn btn-small pull-right" title = "Add customized impaired waters layers" onclick="$('#layerSelectionModal').toggle(); initImpairedModule()" href="#"><i class="icon-plus"></i></button></div>
                                                            <div class="span1"><button id="impLyrToggler" class="close" onclick="impLyrsMinizer()" type="button"></button></div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="selSortable1" class="">   </div>
                                                    </div>




                                                    <div class="sortable" id="sortable">
                                                    </div>
                                                    <div id="GDRSnote">* Layer available only inside the DNR network </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="featureTab2" >
                                        <div id="legendAux" style="min-height: 10%;" class="tab-content"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="analysisPlusPlace"> </div>
                        

                        <div id="menuPlace">
                            <div id = "accordion2_3" class="" style="margin-bottom:0px;">
                                <button type="button" class="close" style="opacity:0.9" onclick="$('#menuPlace').fadeToggle();">&times;</button>
                                
                                <div id="accordion2_2" class = "well sideItem menuWrapperW">


                                <div id = "indexTitleMain" class='compHeadFont' >ECOLOGICAL HEALTH SCORES:</div>
                                <div class="accordion" id="accordion2" style="overflow: auto">
                                    <div id='hiddenPieace' style="display: none">
                                        <ul>
                                            <li><a tabindex="-1" id="5" href="#" onclick="respond('Hyd Index - Perennial Cover, 2011 (major)', 'Perennial Cover (watershed scale)', 'perrenCoverButton');">Watershed Scale</a></li>
                                            <li><a tabindex="-1" id="6" href="#" onclick="respond('Hyd Index - Impervious Cover, 2011 (major)', 'Impervious Cover (watershed scale)', 'impervCoverButton');">Watershed Scale</a></li>
                                            <li><a tabindex="-1" id="7" href="#" onclick="respond('Hyd Index - Water Withdrawal (major)', 'Water Withdrawal Score (watershed scale)', 'watWithdrawButton');">Watershed Scale</a></li>
                                            <li><a tabindex="-1" id="12" href="#" onclick="respond('Geo Index - Soil Erosion Potential (major)', 'Soil Erosion Susceptibility (watershed scale)', 'SoilErosBtn');">Watershed Scale</a></li>
                                            <li><a tabindex="-1" id="17" href="#" onclick="respond('Bio Index - Terrestrial Habitat Quality (major)', 'Terrestrial Habitat Quality (watershed scale)', 'terHabQualBtn');">Watershed Scale</a></li>  
                                            <li><a tabindex="-1" id="24" href="#" onclick="respond('Con Index - Aquatic Connectivity (major)', 'Aquatic Connectivty Score (watershed scale)', 'aqConBtn');">Watershed Scale</a></li>
                                            <li><a tabindex="-1" id="25" href="#" onclick="respond('Con Index - Riparian Connectivity (major)', 'Riparian Connectivty Score (watershed scale)', 'ripConBtn');">Watershed Scale</a></li>
                                        </ul>
                                    </div>



                                    <div class="accordion-groupComp hydroOn">
                                        <div id="hydroCord" class="accordion-heading"><a class="accordion-toggle compFont" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne" onclick="rightCompColllapsser('collapseOne',1)">HYDROLOGY</a>
                                        </div>

                                        <div id="collapseOne" class="compi accordion-body collapse" style="height: 0px;">
                                            <div class="accordion-inner hydroIn">
                                                    
                                                <div class="scoreButton" id = "H_S_MEAN" style="width:100%;"><a id="3" class="span12 btn" onclick="respond('Hyd - Mean Score (major)', 'Hydrology Mean', '3');">Hydrology Mean</a>
                                                </div>
                                                <div class="scoreButton" id = "H_S_PC" style="width:100%;"><a id="31" class="span12 btn" onclick="respond('Hyd Index - Perennial Cover, 2011', 'Perennial Cover (catchment scale)', '31')"> Perennial Cover </a>
                                                </div>
                                                <div class="scoreButton" id = "H_S_IC" style="width:100%;vertical-align: middle;"><a id="49" class="span12 btn" onclick="respond('Hyd Index - Impervious Cover, 2011', 'Impervious Cover', '49');"> Impervious Cover</a>
                                                </div>
                                                
                                                <div class="scoreButton" id = "H_S_WW" style="width:100%;vertical-align: middle;"><a id="35" onclick="respond('Hyd Index - Water Withdrawal', 'Water Withdrawal', '35');" class="span12 btn"  data-toggle="collapse" data-target="#collapse35"> Water Withdrawal <span class="caret"></span><span id="WaterChartsBtn" class="btn btn-mini pull-right" style="padding: 0 2px" data-placement="left" title="Water withdrawal charts for map location" onclick="setModalElement($('#myModal'));$('#myModal').show('blind'); getWBcharts();"><i class="icon-plus-sign"></i></span></a>
                                                </div>
                                                <div id="collapse35" class="collapse out">
                                                    <ul class="dropdown-menu span12 WS_Ctmnt" role="menu" aria-labelledby="dropdownMenu" style="display: block;position: static;margin-bottom: 8px;margin-top: 3px;">
                                                        <li id="36li" class="scoreBtn"><a tabindex="-1" id="h_i_ww_pv" href="#" onclick="respond('Hyd Index - Water Withdrawal, Predicted Vulnerability', 'Predicted Water Withdrawal', 'watWithdrawButton');">Predicted Vulnerability</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="scoreButton" id = "H_S_HS"  style="width:100%;vertical-align: middle;"><a id="8" class="span12 btn" data-toggle="collapse" data-target="#collapse37" onclick="respond('Hyd Index - Loss of Hydrologic Storage', 'Hydrologic Storage', '8')"> Hydrologic Storage <span class="caret"></span></a>
                                                </div>
                                                <div id="collapse37" class="collapse out">
                                                    <ul class="dropdown-menu span12 WS_Ctmnt" role="menu" aria-labelledby="dropdownMenu" style="display: block;position: static;margin-bottom: 8px;margin-top: 3px;">
                                                        <li id="37li" class="scoreBtn"><a tabindex="-1" id="h_m_lhs_aw" href="#" onclick="respond('Hyd Metric - Loss of Hydrologic Storage, Altered Watercourse', 'Natural/Altered Watercourse ratio', '8');">Altered Watercourses</a>
                                                        </li>
                                                        <li id="48li" class="scoreBtn"><a tabindex="-1" id="h_m_lhs_wl" href="#" onclick="respond('Hyd Metric - Loss of Hydrologic Storage, Wetland Loss', 'Wetland Loss', '8');">Wetland Loss</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="scoreButton" id = "H_S_FV" style="width:100%;"><a id="9" class="btn span12" onclick="respond('Hyd Index - Flow Variability (major)','Flow Variability', '9');">Flow Variability</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="accordion-groupComp geomoOn">
                                        <div class="accordion-heading"><a class="accordion-toggle compFont" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo" onclick="rightCompColllapsser('collapseTwo', 1)"> GEOMORPHOLOGY</a>
                                        </div>
                                        <div id="collapseTwo" class="compi accordion-body collapse" style="height: 0px;">
                                            <div class="accordion-inner geomoIn">
                                                
                                                <div class="scoreButton" id = "G_S_MEAN" style="width:100%;"><a id="10" class="span12 btn" onclick="respond('Geo - Mean Score (major)','Geomorphology Mean', '10');"> Geomorphology Mean</a>
                                                </div>
                                                <div class="scoreButton" id = "G_S_SES" style="width:100%;vertical-align: middle;"><a id="32" class="span12 btn" onclick="respond('Geo Index - Soil Erosion Potential', 'Soil Erosion Susceptibility', '32');"> Soil Erosion Susceptibility</a>
                                                </div>
                                                <div class="scoreButton" id = "G_S_GCS" style="width:100%;"><a id="13" class="btn span12" onclick="respond('Geo Index - Groundwater Contamination Susceptibility (major)','Groundwater Contamination Susc.', '13');">Groundwater Contamination Susceptibility</a>
                                                </div>
                                                <div class="scoreButton" id = "G_S_CV" style="width:100%;"><a id="14" class="btn span12" onclick="respond('Geo Index - Climate Vulnerability (major)','Climate Vulnerability', '14');">Climate Vulnerability</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="accordion-groupComp bioloOn">
                                        <div class="accordion-heading"><a class="accordion-toggle compFont" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree" onclick="rightCompColllapsser('collapseThree',1)">BIOLOGY</a>
                                        </div>
                                        <div id="collapseThree" class="compi accordion-body collapse" style="height: 0px;">
                                            <div class="accordion-inner bioloIn">
                                               
                                                <div class="scoreButton" id = "B_S_MEAN" style="width:100%;">
                                                    <a href="#" id="15" class="btn span12" data-toggle="popover" data-container="body" data-content="" title="" onclick="respond('Bio - Mean Score (major)','Biology Mean', '15');">Biology Mean </a>
                                                </div>
                                                <div class="scoreButton" id = "B_S_THQ" style="width:100%;vertical-align: middle;"><a id="50" class="span12 btn" onclick="respond('Bio Index - Terrestrial Habitat Quality', 'Terrestrial Habitat Quality', '50');"> Terrestrial Habitat Quality </a>
                                                </div>
                                                <div class="scoreButton" id = "B_S_SSQ" style="width:100%;vertical-align: middle;"><a id="18" class="span12 btn" data-toggle="collapse" data-target="#collapse40" onclick="respond('Bio Index - Stream Species Quality (major)', 'Stream Species Quality', '18')"> Stream Species Quality <span class="caret"></span></a>
                                                </div>
                                                <div id="collapse40" class="collapse out">
                                                    <ul class="dropdown-menu span12 WS_Ctmnt" role="menu" aria-labelledby="dropdownMenu" style="display: block;position: static;margin-bottom: 8px;margin-top: 3px;">
                                                        
                                                        <li id = "40li" class="scoreBtn"><a tabindex="-1" id="b_m_ssq_fi" href="#" onclick="respond('Bio Metric - Stream Species Quality, Fish IBI', 'Fish Index (catchment scale)', 'strSpcRichQualBtn');">Fish (IBI based) </a> 
                                                        </li>
                                                        <li id = "40_39_38li" class="scoreBtn"><a tabindex="-1" id="b_m_ssq_fi_EX" href="#" onclick="respond('Bio Metric - Stream Species Quality, Fish IBI Extrapolated', 'Fish Index (catchment scale incl. extrapolation)', 'strSpcRichQualBtn');">Fish (IBI based) (extrapolated)</a>
                                                        </li>
                                                        <li class="divider"></li>
                                                        <li id = "43li" class="scoreBtn"><a tabindex="-1" id="b_m_ssq_ii" href="#" onclick="respond('Bio Metric - Stream Species Quality, Aquatic Invertebrate IBI', 'Invert. Index (catchment scale)', 'strSpcRichQualBtn');">Invertebrate (IBI based)</a>
                                                        </li>
                                                        <li id = "43_42_41li" class="scoreBtn"><a tabindex="-1" id="b_m_ssq_ii_EX" href="#" onclick="respond('Bio Metric - Stream Species Quality, Aquatic Invertebrate IBI Extrapolated', 'Invert. Index (catchment scale incl. extrapolation)', 'strSpcRichQualBtn');">Invertebrate (IBI based) (extrapolated)</a>
                                                        </li>
                                                        <li class="divider"></li>
                                                        <li id = "47li" class="scoreBtn"><a tabindex="-1" id="b_m_ssq_ms" href="#" onclick="respond('Bio Metric - Mussel Score', 'Mussels Site Score (catchment scale)', 'strSpcRichQualBtn');">Mussels Quality</a>
                                                        </li>
                                                        <li id = "47_48_46li" class="scoreBtn"><a tabindex="-1" id="b_m_ssq_ms_EX" href="#" onclick="respond('Bio Metric - Mussel Score Extrapolated', 'Mussels Site Score (catchment scale incl. extrapolation)', 'strSpcRichQualBtn');">Mussels Quality (extrapolated)</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="scoreButton" id = "B_S_SR" style="width:100%;"><a id="19" class="btn span12" data-toggle="popover" data-container="body" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus."  onclick="respond('Bio Index - Animal Species Richness (major)','Animal Species Richness', '19');">Animal Species Richness</a>
                                                </div>
                                                <div class="scoreButton" id = "B_S_ARSR" style="width:100%;"><a id="20" class="span12 btn" data-toggle="popover" data-container="body" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus."  onclick="respond('Bio Index - At Risk Species Richness (major)','At-Risk Animal Spec. Richness', '20');"> At-Risk Animal Spec. Richness </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="accordion-groupComp conneOn">
                                        <div class="accordion-heading "><a class="accordion-toggle compFont" data-toggle="collapse" data-parent="#accordion2" href="#collapseFour" onclick="rightCompColllapsser('collapseFour',1)">CONNECTIVITY</a>
                                        </div>
                                        <div id="collapseFour" class="compi accordion-body collapse" style="height: 0px;">
                                            <div class="accordion-inner conneIn">
                                               
                                                <div class="scoreButton" id = "C_S_MEAN" style="width:100%;"><a id="21" class="btn span12" onclick="respond('Con - Mean Score (major)', 'Connectivity Mean', '21');">Connectivity Mean</a>
                                                </div>
                                                <div class="scoreButton" id = "C_S_THC" style="width:100%;"><a id="23" class="btn span12" onclick="respond('Con Index - Terrestrial Habitat Connectivity (major)', 'Terrestrial Habitat Connectivity', '23');">Terrestrial Habitat Connectivity</a>
                                                </div>
                                                <div class="scoreButton" id = "C_S_AC" style="width:100%;vertical-align: middle;"><a id="33" class="span12 btn" onclick="respond('Con Index - Aquatic Connectivity', 'Aquatic Connectivty', '33');"> Aquatic Connectivity</a>
                                                </div>
                                                <div class="scoreButton" id = "C_S_RC"  style="width:100%;vertical-align: middle;"><a id="34" class="span12 btn" onclick="respond('Con Index - Riparian Connectivity', 'Riparian Connectivty', '34');"> Riparian Connectivity</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="accordion-groupComp" data-original-title="" title="">
                                        <div class="accordion-heading waterOn" data-original-title="" title=""><a onclick="rightCompColllapsser('collapseFive',1)" data-toggle="collapse" data-parent="#accordion2" href="#collapseFive" class="accordion-toggle compFont" data-original-title="" title="">WATER QUALITY</a>
                                        </div>
                                        <div style="height: 0px;" class="compi accordion-body collapse" id="collapseFive" data-original-title="" title="">
                                            <div class="accordion-inner waterIn" data-original-title="" title="">
                                                
                                                <div style="width:100%;" id="W_S_MEAN" class="scoreButton" data-original-title="" title=""><a onclick="respond('WQ - Mean Score (major)', 'Water Quality Mean', '26');" class="btn span12" id="26" data-original-title="" title="">Water Quality Mean</a>
                                                </div>
                                                <div style="width:100%;" id="W_S_NPS" class="scoreButton" data-original-title="" title=""><a onclick="respond('WQ Index - Non-Point Source (major)', 'Non-Point Source', '28');" data-target="#collapse45" data-toggle="collapse" class="btn span12" id="28" data-original-title="" title="">Non-Point Source <span class="caret" data-original-title="" title=""></span> </a>
                                                </div>
                                                <div class="collapse out" id="collapse45" data-original-title="" title="">
                                                    <ul style="display: block;position: static;margin-bottom: 8px;margin-top: 3px;" aria-labelledby="dropdownMenu" role="menu" class="dropdown-menu span12 WS_Ctmnt" data-original-title="" title="">

                                                        <li class="scoreBtn" id="66li" data-original-title="" title=""><a onclick="respond('WQ Metric - Non-Point Source, Phosphorus Risk', 'Phosphorus Risk', '28');" href="#" id="w_m_nps_pr" tabindex="-1" data-original-title="" title="">Phosphorus Risk</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div style="width:100%;vertical-align: middle;" id="W_S_PS" class="scoreButton" data-original-title="" title=""><a onclick="respond('WQ Index - Localized Pollution Sources', 'Localized Pollution Sources', '29');" data-target="#collapse44" data-toggle="collapse" class="span12 btn" id="29" data-original-title="" title=""> Localized Pollution Sources <span class="caret" data-original-title="" title=""></span></a>
                                                </div>
                                                <div class="collapse out" id="collapse44" data-original-title="" title="">
                                                    <ul style="display: block;position: static;margin-bottom: 8px;margin-top: 3px;" aria-labelledby="dropdownMenu" role="menu" class="dropdown-menu span12 WS_Ctmnt" data-original-title="" title="">

                                                        <li class="scoreBtn" id="44li" data-original-title="" title=""><a onclick="respond('WQ Metric - Localized Pollution Sources, Animal Units', 'Animal Units', '29');" href="#" id="w_m_ps_a" tabindex="-1" data-original-title="" title="">Animal Units</a>
                                                        </li>
                                                        <li class="scoreBtn" id="59li" data-original-title="" title=""><a onclick="respond('WQ Metric - Localized Pollution Sources, Potential Contaminants', 'Potential Contaminants', '29');" href="#" id="w_m_ps_pc" tabindex="-1" data-original-title="" title="">Potential Contaminants</a>
                                                        </li>
                                                        <li class="scoreBtn" id="60li" data-original-title="" title=""><a onclick="respond('WQ Metric - Localized Pollution Sources, Superfund Sites', 'Superfund Sites', '29');" href="#" id="w_m_ps_sf" tabindex="-1" data-original-title="" title="">Superfund Sites</a>
                                                        </li>
                                                        <li class="scoreBtn" id="61li" data-original-title="" title=""><a onclick="respond('WQ Metric - Localized Pollution Sources, Wastewater Treatment Plants', 'Wastewater Treatment Plants', '29');" href="#" id="w_m_ps_wtp" tabindex="-1" data-original-title="" title="">Wastewater Treatment Plants</a>
                                                        </li>
                                                        <li class="scoreBtn" id="62li" data-original-title="" title=""><a onclick="respond('WQ Metric - Localized Pollution Sources, Open Pit Mines', 'Open Pit Mines', '29');" href="#" id="w_m_ps_opm" tabindex="-1" data-original-title="" title="">Open Pit Mines</a>
                                                        </li>
                                                        <li class="scoreBtn" id="63li" data-original-title="" title=""><a onclick="respond('WQ Metric - Localized Pollution Sources, Septic Systems', 'Septic Systems', '29');" href="#" id="w_m_ps_ss" tabindex="-1" data-original-title="" title="">Septic Systems</a>
                                                        </li>

                                                    </ul>
                                                </div>
                                                <div style="width:100%;" id="W_S_WQA" class="scoreButton" data-original-title="" title=""><a onclick="respond('WQ Index - Water Quality Assessments (major)', 'Assessments', '30');" class="btn span12" id="30" data-original-title="" title="">Assessments</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="accordion-groupComp combOn">
                                        <div class="accordion-heading "><a class="accordion-toggle compFont" data-toggle="collapse" data-parent="#accordion2" href="#collapseSix" onclick="rightCompColllapsser('collapseSix',1)">COMBINED SCORES</a>
                                        </div>
                                        <div id="collapseSix" class="compi accordion-body collapse" style="height: 0px;">
                                            <div class="accordion-inner">

                                                <div class="scoreButton" id = "A_S_MEAN" style="width:100%;"><a id="1" class="btn span12" onclick="respond('Overall Average (major)', 'Combined Mean Scores', '1');">Combined Mean Scores</a>
                                                </div>
                                                <br>
                                                <div class="scoreButton" id = "A_S_MIN" style="width:100%;"><a id="2" class="btn span12" onclick="respond('Overall Minimum (major)','Lowest Index Scores', '2');">Lowest Index Scores</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                </div>
                            </div>

                        </div>
                    </div>

                   
                    <div id="mapScalePlace">
                        
                    </div>

                    <div id="snapShotsArea" class="well snapShotsAreaStrip" style="position:absolute"></div>  


                    <div id="legend" data-toggle="tooltip" data-placement="left" style="display: none;">
                        <div>
                            <img id="legend_bar" data-toggle="tooltip" data-placement="left" SRC="./img/WHAF_legend5.jpg" class="img-polaroid" usemap="#scores" border="0">
                            <map name="scores">
                                <area data-toggle="tooltip" data-placement="left" title="91-100" shape="rect" coords="1,4,17,21">
                                <area data-toggle="tooltip" data-placement="left" title="81-90" shape="rect" coords="1,23,17,38">
                                <area data-toggle="tooltip" data-placement="left" title="71-80" shape="rect" coords="1,41,17,55">
                                <area data-toggle="tooltip" data-placement="left" title="61-70" shape="rect" coords="1,57,17,74">
                                <area data-toggle="tooltip" data-placement="left" title="51-60" shape="rect" coords="1,76,17,91">
                                <area data-toggle="tooltip" data-placement="left" title="41-50" shape="rect" coords="1,93,17,107">
                                <area data-toggle="tooltip" data-placement="left" title="31-40" shape="rect" coords="1,110,17,125">
                                <area data-toggle="tooltip" data-placement="left" title="21-30" shape="rect" coords="1,127,17,142">
                                <area data-toggle="tooltip" data-placement="left" title="11-20" shape="rect" coords="1,144,17,159">
                                <area data-toggle="tooltip" data-placement="left" title="0-10" shape="rect" coords="1,162,17,196">
                            </map>
                            <div id="best" class="nav-header" style="width: 35px;">
                                <h6 align="left"><strong>High</strong></h6>
                            </div>
                            <div id="worst" class="nav-header" style="width: 35px;">
                                <h6 align="left"><strong>Low</strong></h6>
                            </div>
                        </div>
                    </div>



                    <div id="bookmarkModal" class="well" data-backdrop="false" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="position:absolute">

                        <div id="bMarkHead" class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true" onclick="$('#bookmarkModal').hide()">×</button>
                            <h4>Map bookmarks</h4>
                        </div>
                        <div id="bookBox">
                        </div>
                        <div id="bookmarkInnerBox" class="btn-group" style = "width: 100%;">
                            <input id="bookMarkInput" class="span12 dropdown-toggle" autocomplete="off" placeholder="Add bookmark..." data-toggle="dropdown" type="text">
                            <div>
                                <textarea id="bookMarkNotes" class="span12" rows="2" autocomplete="off" placeholder="Notes"></textarea>
                            </div>
                            <ul id="bookMarkList" class="dropdown-menu span12" style="display: block; position: relative;margin-left: 0px;  max-height: 200px;" role="menu" aria-labelledby="dropdownMenu">

                            <li href="#" id="importGalButton" class="btn btn-small btn-warning span12" data-toggle="" data-placement="" onclick = "$('#advancedBMarkFunction').toggle()">Advanced bookmark functions
                            </li>
                            </ul>
                        </div>
                        <div class="modal-footer">
                            <!-- <a href="#" class="btn">Close</a> -->
                            <a href="#" class="btn btn-info" data-toggle="tooltip" data-placement="top" onclick = "storeMap()" title="Bookmark current map and features">Keep map </a>
                            <a href="#" class="btn btn-info" data-toggle="tooltip" data-placement="top" onclick = "storeExtent()" title="Bookmark map location only">Keep extent</a>

                        </div>
                        <div id="advancedBMarkFunction" class="modal-footer" style="display:none">
                            <a href="#" class="btn btn-small btn-danger" data-toggle="tooltip" data-placement="top" onclick = "BMWarner(); $('#advancedBMarkFunction').hide()" title="Delete bookmark list">Delete all</a>
                            <a href="#" class="btn btn-small btn-warning" data-toggle="tooltip" data-placement="top" onclick = "advMenuSetup('expFile'); $('#advancedBMarkFunction').hide()" title="Obtain data to share bookmarks">Download file</a>
                            
                            <a href="#" class="btn btn-small btn-warning btn-file" data-toggle="tooltip" data-placement="top" onclick = "advMenuSetup('impFile'); $('#advancedBMarkFunction').hide()" title="Obtain bookmarks from file">Upload file</a>
                            <a href="#" class="btn btn-small btn-warning" data-toggle="tooltip" data-placement="top" onclick = "bookMarksToSnaps(); $('#advancedBMarkFunction').hide()">Create gallery (beta)</a>

                        </div>

                    </div>

                    <div id="info1" class="well span10 offset1" style="display: none;">
                    </div>

                    <img id="loader" SRC="./img/loaderX.gif" />
                    <img id="loader2" SRC="./img/loaderX.gif" />

                    <div id="StateIcon" class="info6Image" data-toggle="tooltip" data-placement="right" title="Return to full state view">
                        <a href="#" data-original-title="">
                            <img SRC="./img/state_container.png" alt="" onclick="map.setExtent(stateExtentBuffer(0.2))">
                        </a>
                    </div>
                   
                    <div id="back" class="" data-toggle="tooltip" data-placement="right" title="Go to previous or next map extent">
                        <div class="btn-group">
                            <button id="zoomprev" class="backItems info6Image" onClick="prev();"><i class=" icon-chevron-left"></i>
                            </button>
                            <button id="zoomnext" class="backItems info6Image" onClick="next();hideLoad();reorderer();"><i class=" icon-chevron-right"></i>
                            </button>
                        </div>
                    </div>

                    <div id="getIt" class="btn-group" style="display:none">
                        <button class="btn-mini" onClick="$('#theSide').fadeToggle('slide')"><i class="icon-question-sign"></i>
                        </button>
                    </div>
                   
                    <div id="menuBox">

                        <a href='#' title="Show ecological health scores"><img id="menu_scores" class="img-rounded info5Image" src="./img/svgs/leaf.svg" onClick="$('#featuresPlace, #printPlace').hide();$('#menuPlace').fadeToggle(); $(this).tooltip().mouseout()"></a>
                        <a href='#' title="Add features to map"><img id="menu_features" class="img-rounded info5Image" src="./img/mapMarker.png" onClick="$('#menuPlace, #printPlace').hide();$('#featuresPlace').fadeToggle()"></a>
                        <a id="baseMIcB" href='#' title="Change basemap"><img id="menu_base" class="img-rounded info5Image" src="./img/basemap.png" onClick="$(this).tooltip().mouseout(); $('#baseHome').fadeToggle(); alignItemsVert('baseMIcB','baseHome'); "></a>
                        <a  id="shareIcB" href='#' title="Get link for this map view"><img id="menu_share" class="img-rounded info5Image" src="./img/share.png" onClick="refreshMapParams();showShare()"></a>
                        <a id = "bookMarkIc" href='#' title="Save map view or location"><img id="menu_bkmark" class="img-rounded info5Image" src="./img/bookmark.png" onClick="$('#bookmarkModal').fadeToggle(); $(this).tooltip().mouseout()"></a>
<!-- 
                        <a id="printIcon" href='#' title="Print Map"><img id="printer" class="img-rounded info5Image" src="./img/svgs/print.svg" onclick = "$('#menuPlace, #featuresPlace').hide(); $('#printPlace').fadeIn(); alignItemsVert('printIcon','printPlace');"></a>
 -->                        
                        <a id="refrBIcon" href='#' title="Refresh map"><img id="menu_refresh" class="img-rounded info5Image" src="./img/refresh.png" onClick="refreshMap()"></a>
                        
                        <a id="DSS_star" href='#'><img id ="DssStarImage" title="Click to set or change location mark, double click to remove" class="img-rounded info5Image" src="./img/crosshair.png" onClick="setMode('getPoint'); drawStar()"></a>

                        <a id="addSnapBut" href='#' title="Add to Map Gallery"><img id="menu_addSnap" class="img-rounded info5Image" src="./img/camera.png" onClick="addSnap()"></a>


                    </div>
                    <div id="printPlace">
                        <div id = "printerPlace" class="" style="width: 100%;">

                            <button type="button" class="close" style="opacity:0.9" onclick="$('#printPlace').fadeToggle();resetPbtn();">&times;</button>
                            <div id="printer2_2" class = "well sideItem menuWrapperW">
                                <!-- <div id = "indexTitleMain" class='compHeadFont' >Sharing the map:</div> -->
                                <div id = "printBoxTit" class='compHeadFont' >Print/Export Map</div>
                                <div id="printerInnerBox" class="btn-group" style = "width: 100%;">
                                    <div style = "">   
                                        <input id="mapTitleInput" class="span12 dropdown-toggle" autocomplete="off" placeholder="Title" type="text">
                                    </div>

                                    <div id = "scaleButtonPlace" class="btn-toolbar">
                                        <div class="btn-group" style = "">
                                            <button id = "lOutBtn" class="btn">Layout: Letter (portrait)</button>
                                            <button class="btn dropdown-toggle" data-toggle="dropdown">
                                                <span class="caret"></span>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li role="presentation"><a onclick = "$('#lOutBtn').text('Layout: Letter (portrait)'); changePrintLayout('WHAF_Letter_Portrait')" role="menuitem" >Letter (portrait)</a></li>
                                               <!--  <li role="presentation"><a onclick = "$('#lOutBtn').text('Layout: Letter (landscape)'); changePrintLayout('Letter ANSI A Landscape')" role="menuitem" >Letter (landscape)</a></li>
                                                <li role="presentation"><a onclick = "$('#lOutBtn').text('Layout: Legal (portrait)'); changePrintLayout('Tabloid ANSI B Portrait')" role="menuitem" >11 X 17 (portrait)</a></li>
                                                <li role="presentation"><a onclick = "$('#lOutBtn').text('Layout: Legal (landscape)'); changePrintLayout('Tabloid ANSI B Landscape')" role="menuitem" >11 X 17 (Landscape)</a></li> -->
                                                <li class="divider"></li>
                                                <li role="presentation"><a onclick = "$('#lOutBtn').text('Layout: Map Only'); changePrintLayout('MAP_ONLY')" role="menuitem" >Map Only</a></li>
                                                        
                                            </ul>
                                        </div>

                                    </div>
                                    <div>
                                        <div class="btn-group" style = "">
                                            <button id = "frmtBtn" class="btn">Format: PDF</button>
                                            <button class="btn dropdown-toggle" data-toggle="dropdown">
                                                <span class="caret"></span>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li role="presentation"><a onclick = "$('#frmtBtn').text('Format: PDF'); $('#pBtn').text('Print');changePrintFormat('PDF')" role="menuitem" >PDF</a></li>
                                                <li role="presentation"><a onclick = "$('#frmtBtn').text('Format: JPG'); $('#pBtn').text('Print');changePrintFormat('JPG')" role="menuitem" >JPG</a></li>
                                                <li role="presentation"><a onclick = "$('#frmtBtn').text('Format: PNG8'); $('#pBtn').text('Print'); changePrintFormat('PNG')" role="menuitem" >PNG</a></li>
                                                <li role="presentation"><a onclick = "$('#frmtBtn').text('Format: PNG32');  $('#pBtn').text('Print'); changePrintFormat('SVG')" role="menuitem" >SVG</a></li>
                                                <li class="divider"></li>
                                                <li role="presentation"><a onclick = "$('#frmtBtn').text('Format: GIS'); $('#pBtn').text('Export map as GIS file'); changePrintFormat('GIS')" role="menuitem" >MXD (ArcGIS)</a></li>
                                                        
                                            </ul>
                                        </div>

                                    </div>
                                    <div>
                                        <input id="mapAuthor" class="span12" rows="2" autocomplete="off" placeholder="Created by:" type="text">
                                    </div>
                                    <div>
                                        <textarea id="printNotes" class="span12" rows="2" autocomplete="off" placeholder="Notes"></textarea>
                                    </div>
                                    <div id="pButton" class='pull-right'>
                                        <a href="#" id="pBtn" class="btn btn-info " data-toggle="tooltip" data-placement="top" onclick = "printWHAF(); console.log(mapJSON())" title="">Print</a>
                                        <a href="#" id="pMsg" class="btn" style="display:none" title="">Preparing map, please wait... </a>
                                        <a href="#" id="pErrMsg" class="btn btn-danger" style="display:none" onclick = "$('#pErrMsg').hide(); $('#pBtn').fadeIn()" title="">Printing unsuccessful. Please try again later</a>
                                    </div>
                                    
                                       
                                    </div>

                                   
                                </div>

                            
                            </div>
                        </div>

                </div>

                    <div id="baseHome">
                            <a id="gryB" href="#" data-toggle="tooltip" data-placement="top" title="Gray Map">
                                <img SRC="./img/gray.png" alt="" class="img-circle baseIconPic" position=" border:5" onclick="map.setBasemap('gray');changeWS_Outline('gray');$('#baseHome').hide()">
                            </a>
                            <a id="AerB" href="#" data-toggle="tooltip" data-placement="top" title="Aerial Image" data-original-title="">
                                <img href="#" SRC="./img/imagery.jpg" alt="" class="img-circle baseIconPic" onclick="map.setBasemap('satellite');changeWS_Outline('satellite');$('#baseHome').hide()">
                            </a>
                            <a id="aeIB" href="#" data-toggle="tooltip" data-placement="top" title="Aerial Image with Labels"><img href="#" SRC="./img/ImageryLabels.png" alt="" class="img-circle baseIconPic" onclick="map.setBasemap('hybrid');changeWS_Outline('satellite');$('#baseHome').hide()"></a>
                            <a id="NaGB" href="#" data-toggle="tooltip" data-placement="top" title="National Geographic"><img href="#" SRC="./img/natgeo.jpg" alt="" class="img-circle baseIconPic" onclick="map.setBasemap('national-geographic');changeWS_Outline('natGeo');$('#baseHome').hide()"></a>

                            <a id="DGB" href="#" data-toggle="tooltip" data-placement="top" title="Dark Gray"><img href="#" SRC="./img/darkGray.png" alt="" class="img-circle baseIconPic" onclick="map.setBasemap('dark-gray');changeWS_Outline('satellite');$('#baseHome').hide()"></a>
                    </div>                          

                    <div id="flyOverNote" class="well span6 centered">
                        <button type="button" class="close" onclick="$('#flyOverNote').hide();">&times;</button>
                        <div id="flyOverTitle"><h4>Google Earth Fly-Over</h4></div>
                        <div id="toursPlaceHolder">
                            For a fly-over simulation over this watershed, please downlowd and open this file (for some watersheds, several fly-overs are available). <br><br>
                            <ul id="tourList" class="nav nav-pills nav-stacked"></ul>
                            Files will open in Google Earth, if installed. Once opened, navigate and highlight the watershed or river under "Places" in Google Earth's table of content, and click the "play tour" button. <a href="#" onclick="$('#tourSample').toggle()">Show example</a> 
                            <br> <br>
                            <img id="tourSample" style="display:none" SRC="./img/flyOverTour.png" alt="" class="img-polaroid">
                            <a href="http://www.google.com/earth/download/ge/agree.html" target="_blank">To download Google Earth, click here.</a> 

                        </div>
                    </div> 
                    <div id="adHocMessage" class="well span11 centered">
                        <button type="button" class="close" onclick="$('#adHocMessage').hide();">&times;</button>
                        <div id="adHocMessageTitle"></div>
                        <div id="adHocPlaceHolder">
                            <form class="navbar-form pull-left span12">
                                <input id="adHocPlaceHolde1" autocomplete="off" onclick="this.select();" type="text" class="span12" value="">
                                <input style="display:none" id="adHocPlaceHolde2" placeholder="File name" autocomplete="off" onclick="" type="text" class="span12" value="">
                            </form>
                        </div>
                        <div id="bMarkGetInput" class="modal-footer bkMarAdvanced" style="">
                            <a href="#" id="bMarkFileGetter" style="display:none" class="btn btn-small btn-warning" onclick = "exportAsFile();" title="">Download file </a>
                        </div>
                        
                            <div id="bMarkGetReader" style="" class="btn btn-warning span12" onclick = "" title="">
                            <!-- <form> -->
                                <input id="bMarkFile" type="file" name="files[]" />
                                <output id="WhafBmarkList"></output>
                            <!-- </form> -->
                            </div>
                        
                        <!-- </div> -->
                    </div>

                    <div id="urlAlerter" class="well span11">
                        <button type="button" class="close" onclick="$('#urlAlerter').hide();">&times;</button>
                        <div><strong>Copy this link to share this map or to open in another browser: </strong>
                        </div>
                        <div id="urlPlaceHolder">
                            <form class="navbar-form pull-left span12">
                                <input id="urlPlaceHolde" onclick="this.select();" type="text" class="span12" value="">
                            </form>
                        </div>
                    </div>

                </div>
          

            </div>
    </div>
    </div>
</body>    

    <script src="./js/googleJsapi.js" type="text/javascript"></script>
    <script src="./js/raphael.js" type="text/javascript"></script>
    <script src="./js/pie.js" type="text/javascript"></script>
    <!-- // <script src="http://js.arcgis.com/3.14/"></script> -->
    
    <script src="./js/rawinflate.js"></script>
    <script src="./js/rawdeflate.js"></script>
    <script src="./Scripts/WHAF_auxFeatures.js" type="text/javascript"></script>
    <script src="./Scripts/WHAF_analysis.js" type="text/javascript"></script>
    <script src="./Scripts/WHAF_bookMark_snaps.js" type="text/javascript"></script>
    <script src="./Scripts/WHAF_chartQueries.js" type="text/javascript"></script>
    <script src="./Scripts/WHAF_core.js" type="text/javascript"></script> 
    <script src="./Scripts/WHAF_DSS_startups.js" type="text/javascript"></script>
    <script src="./Scripts/WHAF_guides.js" type="text/javascript"></script>
    <script src="./Scripts/WHAF_indexLayers.js" type="text/javascript"></script>
    <script src="./Scripts/WHAF_map.js" type="text/javascript"></script>
    <script src="./Scripts/WHAF_misc.js" type="text/javascript"></script>
    <script src="./Scripts/WHAF_scaleLayers.js" type="text/javascript"></script>
    <script src="./Scripts/WHAF_utilities.js" type="text/javascript"></script>
    <script src="./Scripts/WHAF_workflow.js" type="text/javascript"></script>
    <script src="./js/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="./js/ui.1.10.3.jquery-ui.js" type="text/javascript"></script>
    <script src="./js/bootstrap.js"></script>
    <script src="./js/bootstrap-colorpicker.js"></script>
    <script src="./js/jquery.extras.js"></script>   
    <script src="./js/js.arcgis.com.3.13.js" type="text/javascript"></script>
    <script>

        // Google analytics code to allow for app traffic tracking
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-73695462-2', 'auto');
        ga('send', 'pageview');
    

        //DEFINING GLOBAL VARIABLES
        // primary global object, mapFeatures - list of aux features we want to display in the primary view of added features.
        var WHAFapp={currentMapParams:{allowedOffset: 10,hillShadeOp:1, Bsmp:'sat',indOp:0.8,theseFeatures:[],mapFeatures:["1.11", "1.13", "1.12", "1.14", "1.15","2.11", "2.12", "2.13"]}, template:{layoutOptions:{},format:'pdf'},snpNumber:1 ,displayedSnap:-1,snapZoom:0.16, sideBySideZoom:0.3, bitly:{'Key':'R_85d9a34c0cd44ff4b05b3b066a8300fd','genAccessKey':'3694b5c419f31188e48e14f3abe720ce8e6aba2b'},demikulu:'',suspender:false,flyOverUrl:"http://files.dnr.state.mn.us/natural_resources/water/watersheds/tool/watersheds/watershed_flyover/",landuseData:{},loadingLyrs:[],nonSelectableLayer:{}, selectableLayer:{loadStatus:"ready",impairmentSelections:{serial:400},fields:{},availId:40},impairments:{url:'http://pca-gis02.pca.state.mn.us/arcgis/rest/services/EDA/swedaV2/MapServer/',group:8,impField:'IMP_PARAM',streams:{layerIds:[9,10],impParams:[],impParamsAsUniqueVal:[]},wetlands:{layerIds:[11,12],impParams:[],impParamsAsUniqueVal:[]},lakes:{layerIds:[13,14],impParams:[],impParamsAsUniqueVal:[]}},genCounter:0};

        var w = window,d = document,e = d.documentElement,g = d.getElementsByTagName('body')[0],x = w.innerWidth || e.clientWidth || g.clientWidth,y = w.innerHeight || e.clientHeight || g.clientHeight, map, mainMap, majors, index, selectedWatershed = {}, starLocation={}, extent, stateExtent, initExtent, content, err, navToolbar, layers, legendd, geocoder, upstGrahics,graphicWSRecord = [],graphicHiLiteWSRecord = [], featureLayersDisplayed = [],layerInfos = [], mapParamObject = {params: false}, analyzer, counterR = 0,unAvailGDRS = 0, layerBoxState={layerBoxPopulated:false};
        var watershedsURL="http://arcgis.dnr.state.mn.us/arcgis/rest/services/ewr/whaf_watersheds/MapServer",assessmentURL = "http://arcgis.dnr.state.mn.us/arcgis/rest/services/ewr/whaf_indexscores/MapServer", waterBudgetURL = "http://arcgis.dnr.state.mn.us/arcgis/rest/services/ewr/whaf_watersheddata/MapServer/5", auxURL = "http://arcgis.dnr.state.mn.us/arcgis/rest/services/ewr/whaf_auxiliaryfeatures_sde/MapServer", masksURL="http://arcgis.dnr.state.mn.us/arcgis/rest/services/ewr/whaf_watersheds/MapServer/";
        var GDRS1 = 'http://arcgis.intranet.mndnr.dnr.state.mn.us/arcgis/rest/services/quicklayers/mndnr_hydrography/MapServer',
            GDRS2 = 'http://arcgis.intranet.mndnr.dnr.state.mn.us/arcgis/rest/services/quicklayers/mndnr_adminfeatures/MapServer',
            GDRS3 = 'http://arcgis.intranet.mndnr.dnr.state.mn.us/arcgis/rest/services/quicklayers/mndnr_environment/MapServer',            
            hillshadeService='http://arcgis.dnr.state.mn.us/arcgis/rest/services/elevation/mn_hillshade_cache/MapServer', 
            hillshadeLayer = 3,hillShadeLayerServed,GDRS_Groups = [GDRS1, GDRS2, GDRS3],layerItemID = 77700, BS, mode, current = 0,oldAuxLayers = [], teaser, auxFeatObject = {}, auxOptions = [],auxFeatObjectNew = {}, auxFeatObjectNew2 = {}, auxFeatObjectUrl = {}, analyzeCtmnts = [],AnalyzeRange = 5,CtmentInMajorQT, analyzeIndexList = [],analyticIndex = {}, messageListAnalyze = [],tempiListi = [],indexNameList = [],identifyTask = false,identifyParams=false, fader = true,indexDesxObj,
                mapParamsList = ["indexLayer", "opcty", "auxFtLst", "aux", "xtnt", "Bsmp", "Upstrm", "Dnstrm", "ctmt", "upSymbol", "dnSymbol", "Mj", "HO", "HS","Plc", "Msk", "tU","tD", "tMj", "tBsn", "tC"], //"auxFtLst" is a deprecated parameter, kept for background compatibility (Oct 2015), replaced by "aux". 

                MaskWS_checker, MaskDnstr_checker, MaskUpstr_checker, MaskCtmnt_checker, graphicsBin=[], runningMapNumber=1, charts={status:false};

            var DSS_objectives = { //global object to handle decision support module parameters
                    point:{}, 
                    name:"",
                    catchmenter:function(){executeCatchQueryC_asFL()}
                };

            var opcity = String(WHAFapp.currentMapParams.hillShadeOp*100);

            var DSS_steps=["Zoom to Area of Interest", "Click to Mark Exact Location", "Get the Right Scale", "Set Objectives", "Review Objectives"], DSS_step=0, DSS_StarState=false, objectiveCurrentView=0, DSS_indexlayer;    

            // QUERY TASKS
            var qtUpstream;            

            //SYMBOLS
            var markerSymbol, noSymb,maskSymbol,mwsSymbol_sat, mwsSymbol_nonSat, bsnSymbol,dnstrSymbol,upstrSymbol,symbol;

        //FUNCTIONS ARRANGING PAGE LAYOUT, JQUERY UI AND CONTROLS 
        $(function () {

            console.log("Allowable Offset: ", WHAFapp.currentMapParams.allowedOffset)




            $('#snapShotsArea').sortable({
                start:function(){
                    $(this).addClass('noclick');
                }
            });
            $('.titlStay').click(function(e) {
                e.stopPropagation();
            });

            popoverInit();
            $('#featureTabs').tabs()
            fixTabsCss();
            var $select = $(".1-100");
            for (i = 1; i <= 50; i++) {
                $select.append($('<option></option>').val(i).html(i))
            };
            $('input, textarea').placeholder();  
            $('#AddingRestPoint').change(function () {processRestUrl2()});
            $('#adHocLayerList').keyup(function (){layerFilter()});
            $(".indexRadio").buttonset();
            $('*').tooltip();
            $("#bookmarkModal .btn").tooltip('disable');
            $('.scoreButton').children().popover({trigger: 'hover', placemnt:'right', html:true});
            $('.scoreBtn').popover({trigger: 'hover', placemnt:'right', html:true});
            $("#sortable").sortable({ cancel: "#hillshadeButton" });            
            $("#sortable").disableSelection();
            $("#sortable").sortable({
                start: function (event, ui) {
                    var start_pos = ui.item.index();
                    var lyr = ui.item[0].id;
                    ui.item.data('start_pos', start_pos);
                },
                update: function (event, ui) {
                    var lyr = ui.item[0];
                    var zz = $(lyr).find("input").attr("onclick").split(" ");
                    var n = zz[2].length - 3;
                    var r = zz[2].substr(1, n);
                    var z = zz[3].length - 1;
                    var q = String(zz[3].substr(0, z));
                    var i = "/";
                    var u = r+i+q;0
                    var start_pos = ui.item.data('start_pos');
                    var end_pos = $(ui.item).index();
                    reorderByList();
                    reorderTheseFeatures();
                }
            });

            $("#selSortable1").sortable({
                update: function(event, ui){
                    reorderImpairesLayers();                
                }
            })

            $("#pieChartModal, #waterUsePlace, #legendPlace, #featuresPlace").draggable({cancel: "#featurePlace, #legendAux",scroll: false});
            $("#myModal, #bookmarkModal").draggable({cancel:"#bookmarkInnerBox", scroll: false});
            $("#layersModal").draggable({cancel: "#adHocLayerListUl, #adHocLayerList, #adHocLayerLister2",scroll: false});
            // $("#appInfoModal").draggable({scroll: true}).resizable();
            $('#layerSelectionModal').draggable({cancel: "#impLayerNameBox, #selTabs"});
            $( "#mapRunSortable" ).sortable().disableSelection();
            $("#myCarousel2").carousel('pause'); $("#myCarouseTut").carousel('pause');
            $( "#hillSlider" ).slider({value: opcity,
                slide: function (event, ui) {
                    changeHillOpacity(ui.value);
                    $("#hillSlider").slider("value", ui.value);
                }
            });
            $( "#aSlider" ).slider({
                value: WHAFapp.currentMapParams.indOp*100,
                slide: function (event, ui) {
                    changeScoreOpacity(ui.value);
                    $("#aSlider").slider("value", ui.value);
                }
            });
            $('.nav-tabs').button();
            $(window).resize(function () {
                resizeElementHeight('map');
                try{resizeElementHeight('dropDownWS', 180)}catch(err){};
            });
            $('#snapMax').mouseenter(function(){
                var k=$('#snapShotsArea').find('.mapSnap').length
                if(k==1){
                    setTimeout(function () {
                        $('#snapShotsArea, #snapMin').fadeIn(800);
                        $('#snapMax').hide();                        
                    }, 300)      
                }
                else if(k>1){
                    setTimeout(function () {
                        $('#snapShotsArea, #snapMin, .snapCtrl').fadeIn(800)
                        $('#snapMax').hide();
                    }, 300)      
                }
            })
        });
        

        //RETRIEVING GOOGLE CHARTS MODULE
        google.load("visualization", "1", {
            packages: ["corechart"]
        });  
       
        //RTRIEVING ESRI API MODULES
        require([
            "dojo/ready",
            "esri/map",
            "esri/dijit/Basemap",
            "esri/symbols/SimpleMarkerSymbol",
            "esri/graphic",
            "esri/layers/FeatureLayer","esri/layers/DynamicMapServiceLayer",
            "esri/layers/ImageParameters",
            "esri/renderers/Renderer",
            "esri/tasks/query",
            "esri/tasks/QueryTask",
            "esri/toolbars/navigation",
            "esri/toolbars/draw",
            "esri/tasks/GeometryService",
            "esri/geometry/Extent",
            "esri/geometry/Point",
            "esri/dijit/Legend",
            "esri/dijit/Print",
            "esri/tasks/PrintTask",
            // "esri/tasks/PrintParameters",
            // "esri/tasks/PrintTemplate", 
            "esri/request", 
            "esri/config",
            "dojo/_base/array",
            "esri/dijit/Geocoder",
            "dojo/dom",
            "dojo/parser",
            "esri/SpatialReference",
            "esri/renderers/SimpleRenderer",
            "dojo/domReady!"

        ],function(ready,Map,Basemap,SimpleMarkerSymbol,Graphic,FeatureLayer,DynamicMapServiceLayer,ImageParameters,Renderer,Query,QueryTask,Navigation,Draw,GeometryService,Extent,Point,Legend,Print,PrintTask,esriRequest,esriConfig,arrayUtils,Geocoder,dom,parser,SpatialReference,SimpleRenderer) { 

            

            function constructorGetter (cons){
                return cons;
            }

            WHAFapp.ExtentCons = constructorGetter(Extent);
            WHAFapp.DrawCons = constructorGetter(Draw);
            WHAFapp.SimpleMarkerSymbolCons = constructorGetter(SimpleMarkerSymbol);
            WHAFapp.GraphicCons = constructorGetter(Graphic);
            WHAFapp.FeatureLayerCons = constructorGetter(FeatureLayer);
            WHAFapp.SimpleRendererCons = constructorGetter(SimpleRenderer);
            WHAFapp.ImageParametersCons = constructorGetter(ImageParameters);
            WHAFapp.DynamicMapServiceLayerCons = constructorGetter(DynamicMapServiceLayer);
            WHAFapp.QueryCons = constructorGetter(Query);
            WHAFapp.QueryTaskCons = constructorGetter(QueryTask);
            WHAFapp.esriRequestCons = constructorGetter(esriRequest);
            WHAFapp.arrayUtilsCons = constructorGetter(arrayUtils);
            // WHAFapp.PrintTemplateCons = constructorGetter(PrintTemplate);
            WHAFapp.PrintTaskCons = constructorGetter(PrintTask);
            // WHAFapp.PrintParamsCons = constructorGetter(PrintParameters);
            WHAFapp.domCons = constructorGetter(dom);
            WHAFapp.mapCons = constructorGetter(Map)


            //PRINTING VARS AND CONFIGURATION
            // WHAFapp.printUrl = "http://arcgis.dnr.state.mn.us/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task";
    

 
            
            parser.parse();
            
            esri.config.defaults.io.alwaysUseProxy=false;
            esri.config.defaults.io.corsDetection = false;

            //DEFINE SYMBOLS

            markerSymbol = new WHAFapp.SimpleMarkerSymbolCons();
            markerSymbol.setPath("M22.5,14H14v8.5c0,0.276-0.224,0.5-0.5,0.5h-4C9.224,23,9,22.776,9,22.5V14H0.5  C0.224,14,0,13.776,0,13.5v-4C0,9.224,0.224,9,0.5,9H9V0.5C9,0.224,9.224,0,9.5,0h4C13.776,0,14,0.224,14,0.5V9h8.5  C22.776,9,23,9.224,23,9.5v4C23,13.776,22.776,14,22.5,14z");
            markerSymbol.setColor('white');



            noSymb = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NULL, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_NULL));
            maskSymbol = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([255, 255, 255, 0]), 0), new dojo.Color([0, 0, 0, .7]));
            mwsSymbol_sat= new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NULL, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([255, 255, 255]), 2), new dojo.Color([125, 125, 125, 0]));
            mwsSymbol_nonSat= new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NULL, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([0, 0, 0]), 3), new dojo.Color([125, 125, 125, 0]));

            bsnOutlineSymbol=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NULL, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([115, 0, 76, 1]), 1.9), new dojo.Color([0, 0, 0, .7]));

            dnstrOutlineSymbol = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NULL, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([0, 0, 255, 1]), 1), new dojo.Color([0, 0, 255, .7]));

            downFill = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_NULL, new dojo.Color([0, 0, 255]), 1), new dojo.Color([0, 0, 255, .6]));

            upFill = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_NULL, new dojo.Color([0, 0, 255]), 1), new dojo.Color([0, 200, 255, .6]));

            upstrOutlineSymbol = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NULL, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([191, 44, 162]), 2), new dojo.Color([125, 125, 125, 0]));

            symbol = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([0, 0, 255]), 1), new dojo.Color([0, 0, 255, .6]));

            blueFill = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_NULL, new dojo.Color([0, 0, 0, 0]), 0), new dojo.Color([0, 0, 255, .6]));

            catOutline = new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NULL, new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID, new dojo.Color([200, 0, 255]), 2), new dojo.Color([125, 125, 125, 0]));

            $('#tutPlace').load('tutorial.html', function(){tutorialLoad()});
            $('#BMWarningPlace').load('BookmarkWarning.html');
            $('#disclaimerPlace').load('disclaimer.html');
            $('#waterUsePlace').load('waterUseCharts.html');
            $('#info1').load('whatsAwatershed.html');            
            $('#mapScalePlace').load('scaleButtons.html', function(){resizeElementHeight('dropDownWS', 180);});
            // $('#appInfoPlace').load('appInfoModal.html');
            $('#layerSelectionModal').load('layerSelect.html');
           
            try{serverTest(masksUrl);}catch(err){console.log("unable to test server")}
            
            getGDRS_Feature(GDRS_Groups);

            try{var classList = $("html").attr('class').split(/\s+/);
                $.each(classList, function (index, item) {
                    if (item == 'dj_ie7' || item == 'dj_ie8') {
                        alert("This application works best on newer versions of Internet Explorer (9 or up), or with other browsers such as Firefox, Chrome or Safari. Please consider swithching to one of those.");
                        $("#dropDownWS").css("width", 250);
                        $("#dropDownHowToList").css("height", 300).css("width", 300);
                    }
                });
            }catch(v){};

            resizeElementHeight('map');
            stateExtent = stateExtentBuffer(0.2);
            
            if(getURLParameter('p') && getURLParameter('p')!== null){
            } else{//IF PARAMETERS ARE PASSED OLD STYLE, CREATE MAP PARAMS OBJECT
                console.log("getting params the old way");
                for (i = 0; i < mapParamsList.length; i++) {
                    if (getURLParameter(mapParamsList[i]) != "null") {
                        mapParamObject[mapParamsList[i]] = getURLParameter(mapParamsList[i]);
                        mapParamObject.params = true;
                    }
                }
            }

            // evalScales(mapParamObject);
            evalExtentParams(mapParamObject);
            evalBaseMapParam(mapParamObject);
            
            map= new Map("map", {
                basemap: evalBaseMapParam(WHAFapp.currentMapParams.Bsmp),
                extent: initExtent
            });

            offsetCheck();
            console.log("Allowable Offset: ", WHAFapp.currentMapParams.allowedOffset)

       
            mainMap = map;
            
            mode = "watershedZoom";

            map.on("load", function (){
                loadQT();                
                $('body').animate({'opacity':1}, 1000);
                initImpairedModule();
            });

            setIndexLayer();

            // setPrintInfo();

            navToolbar = new Navigation(map);
            var spatialReferenceG = new SpatialReference({
                wkid: 102100
            });

            auxInit1();
            
            if (!mapParamObject.auxFtLst){//inserts predefined auxiliary layers into aux layer box if no other parameters are provided by url
                generalImplementation()
            }

            function loadQT() {
                try {
                    WS_functionality();
                    loadBasins();

                } catch (err) {
                    setTimeout(function () {
                        console.log("trying again"), WS_functionality()
                    }, 100);
                };
            };
            map.on("Click", executeClick);
            map.on("Click", executeIdentifyTask);
            map.on("update-start", function(){
                showLoad();
                WHAFapp.mapLoading=1;
            });           
            map.on("update-end", doodleJump);
            function doodleJump(evt){
                $("#loader").hide();
                updateTrigger();
                legendd.refresh()
            }
            map.on("extent-change", function(){offsetCheck()});

            legendd = new Legend({
                map: mainMap,
                layerInfos: layerInfos
            }, "legendAux");
            legendd.startup();

            geocoder = new Geocoder({
                map: map
            }, "search");
            geocoder.startup();
            $('.esriGeocoderSearch').on( "click", function() {searchShow()})
            $('.esriGeocoderReset ').on( "click", function() {searchHide()})

            popBmarkPane();

    });


    </script>
</html>

